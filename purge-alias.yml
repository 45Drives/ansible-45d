---
- name: purge device-alias
  hosts:
    - storage
    
  become: true

  tasks:
    - name: remove tools and device_alias.sh profile script
      file:
        name: "{{ item }}"
        state: absent
      with_items:
        - /etc/profile.d/device_alias.sh
        - /opt/tools
        - /etc/zfs/vdev_id.conf
        - /etc/vdev_id.conf
      failed_when: false
    
    - name: remove udev rules when not zfs
      file:
        name: "{{ item }}"
        state: absent
      with_items:
        - /usr/lib/udev/vdev_id
        - /usr/lib/udev/rules.d/69-vdev.rules
      when:
        - not zfs | bool
    
    - name: reload udev rules
      shell: udevadm trigger
